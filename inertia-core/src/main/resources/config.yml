general:
  # Языковой файл (lang_*.yml), например: "en", "ru".
  lang: "en"
  debug:
    # Выводить ли отладку в консоль.
    console: true
    hitboxes:
      # Дефолтная дальность рендера хитбоксов.
      default-range: 20
      # Максимальная дальность рендера хитбоксов.
      max-range: 100
      # Интервал отрисовки хитбоксов в тиках.
      render-interval-ticks: 2

physics:
  # Точность вычислений: DP (double precision) или SP (single precision).
  precision: DP
  # Количество потоков для генерации/обработки физики.
  worker-threads: 3
  # Режим буфера снапшотов физики: LATEST (только последний кадр) или FIFO (совместимый режим).
  snapshot-mode: LATEST
  terrain-generation:
    # Максимальное количество chunk capture на main-thread за один тик.
    max-capture-per-tick: 4
    # Максимум одновременно выполняемых generation-job в terrain queue.
    max-generate-jobs-in-flight: 3

  chunk-cache:
    # Максимум записей в памяти для кэша физики чанков (0 отключает ограничение).
    max-entries: 4096
    # TTL "горячего" memory cache в секундах (0 отключает истечение).
    memory-ttl-seconds: 900
    # TTL "холодного" disk cache в секундах (0 отключает истечение).
    disk-ttl-seconds: 7200
  task-manager:
    # Максимум одноразових задач за один physics-тік.
    max-one-time-tasks-per-tick: 50
    # Time budget (ns) для виконання one-time фази.
    one-time-budget-nanos: 4000000
    # Time budget (ns) для recurring фази.
    recurring-budget-nanos: 3000000

  mass-spawn:
    # Мінімальний бюджет spawn-операцій за тик.
    min-budget-per-tick: 50
    # Базовий бюджет spawn-операцій за тик.
    base-budget-per-tick: 100
    # Максимальний бюджет spawn-операцій за тик.
    max-budget-per-tick: 200
    # Бюджет у warmup-режимі (перші warmup-ticks).
    warmup-budget-per-tick: 50
    # Кількість початкових тіків із зниженим бюджетом.
    warmup-ticks: 40
    # Крок збільшення бюджету при стабільному TPS.
    budget-increase-step: 10
    # Крок зменшення бюджету при просіданні TPS.
    budget-decrease-step: 20
    # Поріг TPS, який вважається стабільним.
    stable-tps-threshold: 19.2
    # Скільки стабільних тіків потрібно для підвищення бюджету.
    stable-ticks-to-increase-budget: 40
    # Ліміт одночасних масових spawn-job на один світ.
    max-concurrent-jobs-per-world: 2
    # Ліміт одночасних масових spawn-job на одного гравця.
    max-concurrent-jobs-per-player: 1
    # Додатковий ліміт кількості spawn в межах одного job за тик.
    max-spawns-per-job-per-tick: 200


rendering:
  network-entity-tracker:
    # Порог смещения позиции (в блоках). Если объект сдвинулся меньше — обновление позиции не отправляется.
    # Внутри сравнение идёт по квадрату дистанции.
    pos-threshold: 0.01
    # Порог изменения поворота (abs(dot) кватернионов, диапазон 0..1).
    # 1.0 = одинаковые повороты; меньше = сильнее различие. Если dot ниже порога — отправляется обновление.
    rot-threshold-dot: 1.0
    # Дистанция (в блоках) между near/mid LOD.
    mid-distance: 40.0
    # Дистанция (в блоках) между mid/far LOD.
    far-distance: 80.0
    # Для mid/far обновления телепорта отправляются не чаще, чем раз в N тиков
    # (если объект не превысил пороги LOD).
    mid-update-interval-ticks: 1
    far-update-interval-ticks: 2
    # Пороги позиционных изменений для LOD-уровней (в блоках).
    mid-pos-threshold: 0.02
    far-pos-threshold: 0.045
    # Пороги поворота (abs(dot) кватернионов) для LOD-уровней.
    mid-rot-threshold-dot: 0.85
    far-rot-threshold-dot: 0.75
    # Для far-range отключаем часть некритичных metadata-апдейтов.
    far-allow-metadata-updates: true
    # Максимальное число проверок/обновлений видимости для одного игрока за тик.
    # При превышении остаток работы переносится на следующий тик.
    # Этап 1 (+50% от базового профиля): 384.
    max-visibility-updates-per-player-per-tick: 384
    # Жесткий лимит проверок shouldSendUpdate() по уже видимому набору за тик на игрока.
    # Если лимит исчерпан, остаток переносится на следующий тик и учитывается в телеметрии.
    # Этап 1 (+50% от базового профиля): 384.
    max-transform-checks-per-player-per-tick: 384
    # Периодический полный пересчет видимости (в тиках), даже если игрок не сменил чанк/мир.
    full-recalc-interval-ticks: 20
    # Лимит количества сетевых пакетов, отправляемых одному игроку за тик.
    # При превышении лишние пакеты переносятся на следующий тик с учетом приоритета.
    # Этап 1 (+50% от базового профиля): 384.
    max-packets-per-player-per-tick: 384
    # Порог backlog destroy (pending ids/очередь scheduler), начиная с которого включается fast-path
    # осушения destroy с временным приоритетом над visibility/metadata.
    destroy-backlog-threshold: 512
    # Дополнительный пакетный бюджет (сверх max-packets-per-player-per-tick) для destroy-пакетов
    # во время drain fast-path.
    destroy-drain-extra-packets-per-player-per-tick: 128
    # Лимит оценочного размера сетевых пакетов (в байтах) для одного игрока за тик.
    # Этап 1 (+50% от базового профиля): 147456.
    max-bytes-per-player-per-tick: 147456
    # Общий лимит времени (в наносекундах), который render-network scheduler может тратить за 1 серверный тик.
    max-work-nanos-per-tick: 6000000
    # Минимальный коэффициент для второстепенных очередей (visibility-diff и metadata),
    # который применяется при деградации TPS/ping.
    secondary-budget-min-scale: 0.5
    # Порог TPS для мягкого/жесткого снижения budget второстепенных очередей.
    adaptive-tps-soft-threshold: 18.8
    adaptive-tps-hard-threshold: 16.5
    # Порог среднего ping (ms) для мягкого/жесткого снижения budget второстепенных очередей.
    adaptive-ping-soft-threshold-ms: 140
    adaptive-ping-hard-threshold-ms: 260

  # Профили для ручного переключения в зависимости от типа нагрузки.
  # Профиль "high-entity scenes" фиксирует следующий стабильный этап после +50%:
  # visibility/transform/packets: 384 -> 576, bytes: 147456 -> 221184.
  # Перед применением проверяйте TPS и backlog tracker минимум 10-15 минут под целевой нагрузкой.
  profiles:
    high-entity-scenes:
      network-entity-tracker:
        max-visibility-updates-per-player-per-tick: 576
        max-transform-checks-per-player-per-tick: 576
        max-packets-per-player-per-tick: 576
        max-bytes-per-player-per-tick: 221184


performance:
  threading:
    physics:
      # Потоки фізичного job-систему світу (Jolt world threads).
      world-threads: 3
      # Загальний бюджет physics task manager на тік (ms), ділиться між one-time та recurring.
      task-budget-ms: 7
      # Режим черги снапшотів: LATEST або FIFO.
      snapshot-queue-mode: LATEST
    network:
      # Кількість воркерів для async network-compute фази трекера.
      compute-threads: 3
      # Бюджет flush/scheduler в наносекундах на серверний тік.
      flush-budget-nanos: 6000000
      # Ліміт байтів на тік для network flush per-player budget.
      max-bytes-per-tick: 147456
    terrain:
      # Бюджет chunk capture на main-thread (ms) на тік.
      capture-budget-ms: 2
      # Кількість воркерів генерації terrain mesh.
      generate-workers: 3
      # Максимум одночасних in-flight generation задач.
      max-in-flight: 3
